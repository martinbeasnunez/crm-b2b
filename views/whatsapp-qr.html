<div style="max-width: 800px; margin: 20px auto; padding: 20px; text-align: center;">
    <h2>ğŸ“± ConexiÃ³n WhatsApp</h2>
    
    <div style="background: #f8f9fa; border-radius: 10px; padding: 15px; margin: 20px 0; border-left: 4px solid #ffc107;">
        <p><strong>ğŸ”§ Para conectar WhatsApp al CRM:</strong></p>
        <ol style="text-align: left; max-width: 500px; margin: 0 auto;">
            <li>Abre en otra pestaÃ±a: <a href="https://crmwhatsapp3001.loca.lt" target="_blank" style="color: #007bff; text-decoration: underline;">Servidor WhatsApp</a></li>
            <li>Escanea el cÃ³digo QR que aparece</li>
            <li>Una vez conectado, regresa al Pipeline</li>
            <li>Arrastra cualquier tarjeta a "En ConversaciÃ³n"</li>
            <li>Â¡El mensaje se enviarÃ¡ automÃ¡ticamente! ğŸš€</li>
        </ol>
    </div>

    <div style="background: #d4edda; border-radius: 10px; padding: 15px; margin: 20px 0; border-left: 4px solid #28a745;">
        <h3>âœ… Â¿CÃ³mo funciona?</h3>
        <p style="text-align: left; max-width: 600px; margin: 0 auto;">
            <strong>El WhatsApp estÃ¡ integrado directamente en el Pipeline:</strong><br>
            â€¢ Cuando arrastras una tarjeta a <strong>"En ConversaciÃ³n"</strong><br>
            â€¢ Se envÃ­a automÃ¡ticamente un mensaje personalizado al contacto<br>
            â€¢ No necesitas hacer nada mÃ¡s, Â¡es automÃ¡tico! ğŸ¯
        </p>
    </div>

    <div style="background: #fff3cd; border-radius: 10px; padding: 15px; margin: 20px 0; border-left: 4px solid #ffc107;">
        <h3>âš ï¸ Importante</h3>
        <p style="text-align: left; max-width: 600px; margin: 0 auto;">
            â€¢ El servidor WhatsApp debe estar ejecutÃ¡ndose<br>
            â€¢ Solo necesitas conectar WhatsApp <strong>una vez</strong><br>
            â€¢ Los mensajes se envÃ­an solo cuando mueves tarjetas a "En ConversaciÃ³n"<br>
            â€¢ AsegÃºrate de que los leads tengan nÃºmero de telÃ©fono
        </p>
    </div>

    <div style="margin: 30px 0;">
    <button onclick="window.open('https://crmwhatsapp3001.loca.lt', '_blank')" 
                style="background: #25D366; color: white; border: none; padding: 15px 30px; border-radius: 25px; cursor: pointer; font-size: 16px; margin: 10px;">
            ğŸ”— Abrir WhatsApp QR
        </button>
        <button onclick="showTab('pipeline')" 
                style="background: #007bff; color: white; border: none; padding: 15px 30px; border-radius: 25px; cursor: pointer; font-size: 16px; margin: 10px;">
            ğŸ“Š Ir al Pipeline
        </button>
    </div>

    <div style="background: #f8f9fa; border-radius: 10px; padding: 15px; margin: 20px 0;">
        <h3>ğŸš€ Estado del servidor</h3>
        <p id="server-status" style="margin: 10px 0;">Verificando conexiÃ³n...</p>
        <button onclick="checkServerStatus()" 
                style="background: #17a2b8; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">
            ğŸ”„ Verificar Estado
        </button>
    </div>

    <div id="qr-section" style="background: white; border-radius: 15px; padding: 30px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin: 20px 0; display: none;">
        <h3>ğŸ“± CÃ³digo QR WhatsApp</h3>
        <div id="qr-container" style="width: 300px; height: 300px; margin: 20px auto; border: 3px solid #25D366; border-radius: 15px; display: flex; align-items: center; justify-content: center; background: #f8f9fa;">
            <div id="qr-placeholder" style="color: #666; font-size: 16px;">ğŸ”„ Cargando cÃ³digo QR...</div>
        </div>
        <button onclick="loadQRCode()" 
                style="background: #25D366; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px;">
            ğŸ”„ Refrescar QR
        </button>
    </div>
</div>

<script>
function checkServerStatus() {
    const statusEl = document.getElementById('server-status');
    statusEl.textContent = 'ğŸ”„ Verificando...';
    
    fetch('https://crmwhatsapp3001.loca.lt/api/whatsapp/status')
        .then(response => response.json())
        .then(data => {
            if (data.authenticated) {
                statusEl.innerHTML = 'âœ… <strong style="color: #28a745;">WhatsApp Conectado</strong> - Â¡Listo para enviar mensajes!';
                document.getElementById('qr-section').style.display = 'none';
            } else {
                statusEl.innerHTML = 'âš ï¸ <strong style="color: #ffc107;">WhatsApp NO conectado</strong> - Escanea el QR o <a href="https://crmwhatsapp3001.loca.lt" target="_blank" style="color: #007bff;">Ã¡brelo en otra pestaÃ±a</a>';
                document.getElementById('qr-section').style.display = 'block';
                loadQRCode();
            }
        })
        .catch(error => {
            statusEl.innerHTML = 'âŒ <strong style="color: #dc3545;">Servidor no disponible</strong> - Inicia el servidor WhatsApp';
            document.getElementById('qr-section').style.display = 'none';
        });
}

function loadQRCode() {
    const qrContainer = document.getElementById('qr-container');
    const qrPlaceholder = document.getElementById('qr-placeholder');
    
    qrPlaceholder.textContent = 'ğŸ”„ Cargando cÃ³digo QR...';
    
    fetch('https://crmwhatsapp3001.loca.lt/api/whatsapp/status')
        .then(response => response.json())
        .then(data => {
            if (data.qr) {
                qrContainer.innerHTML = '<img src="' + data.qr + '" style="width: 100%; height: 100%; object-fit: contain;" />';
            } else if (data.authenticated) {
                qrPlaceholder.textContent = 'âœ… WhatsApp ya estÃ¡ conectado';
            } else {
                qrPlaceholder.textContent = 'âš ï¸ QR no disponible. Reinicia el servidor.';
            }
        })
        .catch(error => {
            qrPlaceholder.textContent = 'âŒ Error al cargar QR';
        });
}

// Verificar estado al cargar
setTimeout(checkServerStatus, 1000);

// Actualizar estado cada 5 segundos
setInterval(checkServerStatus, 5000);
</script>
